# PAW Blockchain Pre-Commit Hooks Configuration
# Installation:
#   pip install pre-commit
#   pre-commit install
#   pre-commit install --hook-type commit-msg
#
# Run manually:
#   pre-commit run --all-files

default_language_version:
  python: python3.11

repos:
  # General hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: Remove trailing whitespace
        exclude: |
          (?x)(
              ^docs/.*\.md$|
              ^.*\.patch$
          )
      - id: end-of-file-fixer
        name: Fix end of files
        exclude: |
          (?x)(
              ^.*\.patch$|
              ^.*\.diff$
          )
      - id: check-yaml
        name: Check YAML syntax
        args: ['--allow-multiple-documents']
        exclude: |
          (?x)(
              ^\.github/workflows/.*\.ya?ml$
          )
      - id: check-json
        name: Check JSON syntax
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: check-added-large-files
        name: Check for large files
        args: ['--maxkb=1000']
      - id: detect-private-key
        name: Detect private keys
      - id: no-commit-to-branch
        name: Don't commit to main/master
        args: ['--branch', 'master', '--branch', 'main']
      - id: check-case-conflict
        name: Check for case conflicts
      - id: mixed-line-ending
        name: Check for mixed line endings
        args: ['--fix=lf']

  # Go hooks
  - repo: https://github.com/dnephin/pre-commit-golang
    rev: v0.5.1
    hooks:
      - id: go-fmt
        name: Go Format (gofmt)
        args: ['-s']
      - id: go-imports
        name: Go Imports (goimports)
        args: ['-local', 'github.com/paw']
      - id: go-vet
        name: Go Vet (static analysis)
      - id: go-mod-tidy
        name: Go Mod Tidy
      - id: go-unit-tests
        name: Go Unit Tests (fast)
        args: ['-timeout=60s', '-short', '-race', '-cover']
        # Only run on changed .go files
        types: [go]

  # golangci-lint (comprehensive linting)
  - repo: https://github.com/golangci/golangci-lint
    rev: v1.55.2
    hooks:
      - id: golangci-lint
        name: golangci-lint
        args:
          - --config=.golangci.yml
          - --timeout=10m
          - --new-from-rev=HEAD~1
        # Run on all go files except generated
        exclude: |
          (?x)(
              \.pb\.go$|
              \.pb\.gw\.go$
          )

  # Python hooks
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        name: Black (Python formatter)
        language_version: python3.11
        args: ['--line-length=100']

  - repo: https://github.com/PyCQA/pylint
    rev: v3.0.3
    hooks:
      - id: pylint
        name: Pylint (Python linter)
        args:
          - --max-line-length=100
          - --disable=C0103,C0114,C0115,C0116,R0903
        additional_dependencies:
          - cryptography
          - requests

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: MyPy (Python type checker)
        args: [--ignore-missing-imports, --no-strict-optional]
        additional_dependencies:
          - types-requests
          - cryptography

  # JavaScript/TypeScript hooks
  - repo: https://github.com/pre-commit/mirrors-eslint
    rev: v8.56.0
    hooks:
      - id: eslint
        name: ESLint (JavaScript linter)
        files: \.(js|jsx|ts|tsx)$
        args: ['--fix', '--max-warnings=0']
        additional_dependencies:
          - eslint@8.56.0
          - eslint-config-standard@17.1.0
          - eslint-plugin-import@2.29.1
          - eslint-plugin-node@11.1.0
          - eslint-plugin-promise@6.1.1

  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v3.1.0
    hooks:
      - id: prettier
        name: Prettier (JavaScript formatter)
        files: \.(js|jsx|ts|tsx|json|css|scss|md|yaml|yml)$
        args: ['--write', '--ignore-unknown']
        exclude: |
          (?x)(
              ^go\.mod$|
              ^go\.sum$|
              \.pb\.go$
          )

  # Markdown linting
  - repo: https://github.com/markdownlint/markdownlint
    rev: v0.12.0
    hooks:
      - id: markdownlint
        name: Markdownlint
        args: ['--ignore', 'node_modules', '--ignore', 'vendor']
        exclude: |
          (?x)(
              ^PAW\ Extensive\ whitepaper\ \.md$
          )

  # Commit message validation
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.0.0
    hooks:
      - id: conventional-pre-commit
        name: Conventional Commits
        stages: [commit-msg]
        args: []

  # Security scanning
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        name: Detect secrets
        args: ['--baseline', '.secrets.baseline']
        exclude: |
          (?x)(
              \.lock$|
              \.sum$|
              ^tests/.*
          )

  # Shellcheck for bash scripts
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.9.0.6
    hooks:
      - id: shellcheck
        name: ShellCheck
        args: ['--severity=warning']

  # Local hooks for custom validation
  - repo: local
    hooks:
      - id: no-debug-statements
        name: Check for debug statements
        entry: scripts/hooks/check-debug.sh
        language: script
        types: [go]

      - id: check-license-headers
        name: Check license headers
        entry: scripts/hooks/check-license.sh
        language: script
        types: [go]
        pass_filenames: true

      - id: validate-proto
        name: Validate proto files
        entry: scripts/hooks/validate-proto.sh
        language: script
        files: \.proto$
        pass_filenames: true
