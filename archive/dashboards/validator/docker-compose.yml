version: '3.8'

services:
  # Nginx web server for hosting the dashboard
  validator-dashboard:
    image: nginx:alpine
    container_name: paw-validator-dashboard
    ports:
      - "8080:80"
    volumes:
      - ./:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - paw-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "com.paw.service=validator-dashboard"
      - "com.paw.description=PAW Validator Dashboard Web UI"

  # Optional: API proxy for CORS handling
  api-proxy:
    image: nginx:alpine
    container_name: paw-api-proxy
    ports:
      - "8081:80"
    volumes:
      - ./proxy.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - paw-network
    restart: unless-stopped
    depends_on:
      - validator-dashboard
    labels:
      - "com.paw.service=api-proxy"
      - "com.paw.description=API Proxy for PAW blockchain endpoints"

  # Optional: Test runner for running automated tests
  test-runner:
    image: node:18-alpine
    container_name: paw-validator-tests
    working_dir: /app
    volumes:
      - ./:/app
    command: sh -c "npm install && npm test"
    networks:
      - paw-network
    profiles:
      - test
    labels:
      - "com.paw.service=test-runner"
      - "com.paw.description=Test runner for validator dashboard"

networks:
  paw-network:
    driver: bridge
    name: paw-validator-network

volumes:
  dashboard-data:
    driver: local
