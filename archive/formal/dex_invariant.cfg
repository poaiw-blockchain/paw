SPECIFICATION Spec

\* Constants configuration
CONSTANTS
    MAX_RESERVE = 100000
    MIN_LIQUIDITY = 1000
    SWAP_FEE = 30          \* 0.3% in basis points
    MAX_PRICE_RATIO = 1000000
    TRADERS = {t1, t2, t3}

\* State constraints for bounded model checking
CONSTRAINT
    /\ reserveA <= 10000
    /\ reserveB <= 10000
    /\ totalShares <= 10000
    /\ Len(k_history) <= 20
    /\ Len(operation_log) <= 20

\* Invariants to check
INVARIANTS
    TypeOK
    ReservesPositive
    NoOverflow
    KMonotonicOnSwaps
    KPositive
    ProportionalOwnership

\* Properties to verify
PROPERTIES
    Spec => []ReservesPositive
    Spec => []KMonotonicOnSwaps

\* Symmetry optimization
SYMMETRY TRADERS

\* Check for deadlocks
CHECK_DEADLOCK TRUE

\* Model checking configuration
\* Run with: tlc -config dex_invariant.cfg dex_invariant.tla
