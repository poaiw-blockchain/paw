#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# PAW Blockchain Commit Message Validation (Husky)
# This hook validates commit message format using commitlint

# Use commitlint if available
if command -v npx &> /dev/null; then
    npx --no -- commitlint --edit $1
else
    # Fallback to basic validation
    COMMIT_MSG_FILE=$1
    COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

    # Check for conventional commit format
    if ! echo "$COMMIT_MSG" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .+"; then
        echo "❌ Invalid commit message format!"
        echo ""
        echo "Commit message must follow Conventional Commits format:"
        echo "  <type>(<scope>): <subject>"
        echo ""
        echo "Valid types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
        echo ""
        echo "Examples:"
        echo "  feat(wallet): add Fernet encryption support"
        echo "  fix(api): resolve connection timeout issue"
        echo "  docs: update README with installation steps"
        echo ""
        exit 1
    fi

    # Check message length
    SUBJECT_LENGTH=$(echo "$COMMIT_MSG" | head -n1 | wc -c)
    if [ $SUBJECT_LENGTH -gt 100 ]; then
        echo "⚠️  Warning: Commit subject line is too long ($SUBJECT_LENGTH chars)"
        echo "   Consider keeping it under 100 characters"
    fi

    echo "✅ Commit message format is valid"
fi
