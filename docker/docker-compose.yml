version: "3.8"

networks:
  paw-testnet:
    external: true

volumes:
  paw-prometheus-data:
  paw-grafana-data:
  paw-node1-data:
  paw-node2-data:
  paw-node3-data:
  paw-node4-data:

services:
  # Monitoring Stack
  prometheus:
    image: prom/prometheus:latest
    container_name: paw-prometheus
    restart: unless-stopped
    ports:
      - "11090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - paw-prometheus-data:/prometheus
    networks:
      - paw-testnet
    command:
      - "--config.file=/etc/prometheus/prometheus.yml"
      - "--storage.tsdb.path=/prometheus"

  grafana:
    image: grafana/grafana:latest
    container_name: paw-grafana
    restart: unless-stopped
    ports:
      - "11030:3000"
    volumes:
      - paw-grafana-data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=paw-admin
      - GF_USERS_ALLOW_SIGN_UP=false
    networks:
      - paw-testnet
    depends_on:
      - prometheus

  # Placeholder for blockchain nodes - customize per chain type
  # node1:
  #   image: your-paw-node-image
  #   container_name: paw-node1
  #   ports:
  #     - "11001:8545"  # RPC
  #     - "11002:30303" # P2P
  #     - "11003:8546"  # WS
  #   volumes:
  #     - paw-node1-data:/data
  #   networks:
  #     - paw-testnet

  # Block Explorer (Flask)
  explorer:
    build:
      context: ../flask-app
      dockerfile: Dockerfile
    container_name: paw-explorer
    restart: unless-stopped
    network_mode: "host"
    ports:
      - "11080:5000"
    environment:
      - FLASK_ENV=development
      - RPC_URL=http://localhost:26657
      - CHAIN_ID=paw-mvp-1
    volumes:
      - ../flask-app:/app
