# PAW Blockchain v1.1.0 Upgrade

## Overview

This document describes the v1.1.0 upgrade for the PAW blockchain. This is the first planned upgrade and includes critical improvements to the compute, DEX, and oracle modules.

**Upgrade Name:** `v1.1.0`

**Estimated Upgrade Date:** TBD (approximately 14 days after governance approval)

**Upgrade Height:** TBD (will be determined based on governance vote)

## Motivation

The v1.1.0 upgrade introduces critical improvements to ensure the long-term stability and security of the PAW blockchain:

1. **Enhanced State Validation**: Validates and repairs any inconsistencies in module state
2. **Security Hardening**: Initializes new security features across all modules
3. **Migration Framework**: Establishes the foundation for future seamless upgrades

## Changes by Module

### Compute Module

**Consensus Version:** 1 → 2

**Changes:**
- Provider state validation and repair
- Request state validation and repair
- Security features initialization
- Improved error handling and logging

**Impact:**
- No breaking changes to existing functionality
- Existing compute providers continue to operate normally
- All active requests remain valid

### DEX Module

**Consensus Version:** 1 → 2

**Changes:**
- Pool state validation (reserves, shares, fees)
- LP position validation (shares, ownership)
- Security features initialization
- Enhanced pool metadata tracking

**Impact:**
- No breaking changes to trading functionality
- All liquidity pools remain active
- LP positions are preserved
- No impact on swap operations

### Oracle Module

**Consensus Version:** 1 → 2

**Changes:**
- Price feed state validation
- Validator vote validation
- Cryptoeconomic security features initialization
- Enhanced price aggregation reliability

**Impact:**
- No breaking changes to price feeds
- All oracle validators continue normal operation
- Price accuracy improvements through validation

## Pre-Upgrade Checklist

### For Validators

- [ ] Review this upgrade guide thoroughly
- [ ] Ensure your node is running the latest pre-upgrade version
- [ ] Backup your node state: `pawd export > pre-upgrade-state.json`
- [ ] Backup your validator keys and config
- [ ] Ensure sufficient disk space (at least 50GB free recommended)
- [ ] Join the validator coordination channel
- [ ] Test the upgrade on a testnet or local node

### For Node Operators

- [ ] Update monitoring and alerting systems
- [ ] Review upgrade timeline and coordinate downtime
- [ ] Backup node state and configuration
- [ ] Prepare rollback plan (see ROLLBACK.md)
- [ ] Ensure sufficient system resources

### For Developers/Integrators

- [ ] Review API changes (none for v1.1.0)
- [ ] Update client applications if necessary
- [ ] Test applications against upgraded testnet
- [ ] Prepare for brief chain halt during upgrade

## Upgrade Procedure

### Automatic Upgrade (Recommended)

If using Cosmovisor for automatic upgrades:

```bash
# 1. Download the new binary
wget https://github.com/paw-chain/paw/releases/download/v1.1.0/pawd-v1.1.0-linux-amd64.tar.gz

# 2. Verify checksum
sha256sum pawd-v1.1.0-linux-amd64.tar.gz
# Expected: [CHECKSUM_WILL_BE_PROVIDED]

# 3. Extract and setup
tar -xzf pawd-v1.1.0-linux-amd64.tar.gz
mkdir -p $DAEMON_HOME/cosmovisor/upgrades/v1.1.0/bin
cp pawd $DAEMON_HOME/cosmovisor/upgrades/v1.1.0/bin/

# 4. Cosmovisor will automatically upgrade at the specified height
# Monitor logs: tail -f $DAEMON_HOME/cosmovisor/current/pawd.log
```

### Manual Upgrade

If not using Cosmovisor:

```bash
# 1. Monitor for upgrade height
pawd status | jq '.SyncInfo.latest_block_height'

# 2. When upgrade height is reached, the chain will halt
# You will see: "UPGRADE \"v1.1.0\" NEEDED at height: XXXXX"

# 3. Stop your node
sudo systemctl stop pawd

# 4. Backup current state
pawd export > pre-upgrade-state.json

# 5. Download and install new binary
wget https://github.com/paw-chain/paw/releases/download/v1.1.0/pawd-v1.1.0-linux-amd64.tar.gz
tar -xzf pawd-v1.1.0-linux-amd64.tar.gz
sudo cp pawd /usr/local/bin/

# 6. Verify version
pawd version
# Should output: v1.1.0

# 7. Restart node
sudo systemctl start pawd

# 8. Monitor logs
journalctl -u pawd -f
```

## Post-Upgrade Verification

After the upgrade completes:

```bash
# 1. Verify chain is producing blocks
pawd status | jq '.SyncInfo.catching_up'
# Should return: false

# 2. Check module versions
pawd query upgrade module_versions
# compute: 2
# dex: 2
# oracle: 2

# 3. Verify your validator is signing
pawd query slashing signing-info $(pawd tendermint show-validator)

# 4. Test basic functionality
pawd query bank balances $(pawd keys show -a validator)
pawd query staking validators
```

## Governance Proposal

To submit the upgrade proposal:

```bash
pawd tx gov submit-proposal software-upgrade v1.1.0 \
  --title "PAW v1.1.0 Upgrade" \
  --description "Upgrade to v1.1.0 with state validation and security improvements" \
  --upgrade-height <UPGRADE_HEIGHT> \
  --upgrade-info '{"binaries":{"linux/amd64":"https://github.com/paw-chain/paw/releases/download/v1.1.0/pawd-v1.1.0-linux-amd64.tar.gz"}}' \
  --deposit 10000000upaw \
  --from validator \
  --chain-id paw-1 \
  --gas auto \
  --gas-adjustment 1.5 \
  --yes
```

## Timeline

1. **Proposal Submission**: T+0 days
2. **Voting Period**: 7 days
3. **Upgrade Height**: Approximately 14 days after proposal (if approved)
4. **Expected Downtime**: 10-30 minutes

## Testing

The v1.1.0 upgrade has been tested on:

- Local development networks
- PAW testnet (paw-testnet-1)
- Integration test suite
- Load testing with simulated state

Test results are available in the repository.

## Support

If you encounter issues during the upgrade:

1. Check the troubleshooting section below
2. Review validator logs for error messages
3. Join the validator coordination channel
4. Contact the core development team

## Troubleshooting

### Chain fails to restart after upgrade

```bash
# Check logs for error messages
journalctl -u pawd -n 100

# Common issues:
# - Incorrect binary version
# - Corrupted state (restore from backup)
# - Insufficient disk space
```

### State export fails

```bash
# Use --height flag to export at specific height
pawd export --height <HEIGHT_BEFORE_UPGRADE> > state.json
```

### Binary checksum mismatch

```bash
# Verify download integrity
sha256sum pawd-v1.1.0-linux-amd64.tar.gz

# Re-download if checksum doesn't match
```

## Rollback Procedure

If critical issues are discovered, see [ROLLBACK.md](./ROLLBACK.md) for detailed rollback instructions.

## Additional Resources

- [Upgrade Testing Guide](../guides/testing/UPGRADE_TESTING.md)
- [Cosmovisor Setup Guide](../guides/deployment/COSMOVISOR.md)
- [Validator Operations Guide](../guides/deployment/VALIDATOR_SETUP.md)
- [ Release](https://github.com/paw-chain/paw/releases/tag/v1.1.0)

## Changelog

### Compute Module (v2)
- Added provider state validation
- Added request state validation
- Initialized security features
- Improved migration logging

### DEX Module (v2)
- Added pool state validation
- Added LP position validation
- Initialized security features
- Enhanced pool metadata

### Oracle Module (v2)
- Added price feed validation
- Added validator vote validation
- Initialized cryptoeconomic features
- Improved price aggregation reliability

## FAQ

**Q: Will there be any downtime?**
A: Yes, the chain will halt at the upgrade height for approximately 10-30 minutes while validators upgrade their nodes.

**Q: Do I need to do anything as a token holder?**
A: No, token holders do not need to take any action. Your tokens will be safe during the upgrade.

**Q: What happens to pending transactions?**
A: Pending transactions in the mempool will be cleared. You may need to resubmit transactions after the upgrade.

**Q: Can I skip this upgrade?**
A: No, this is a consensus-breaking upgrade. All validators must upgrade to continue participating in the network.

**Q: Is this upgrade backward compatible?**
A: No, nodes running the old version will not be able to sync with the upgraded chain.

---

**Last Updated:** 2025-11-25
**Version:** 1.0
**Authors:** PAW Core Development Team
