---
# Vertical Pod Autoscaler for PAW Validator
# Provides resource recommendations based on actual usage
# updateMode: "Off" = recommendation only (safe for production)
# updateMode: "Auto" = automatic updates (use with caution)
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: paw-validator-vpa
  namespace: paw
  labels:
    app.kubernetes.io/name: paw
    app.kubernetes.io/component: validator
spec:
  targetRef:
    apiVersion: "apps/v1"
    kind: StatefulSet
    name: paw-validator
  updatePolicy:
    updateMode: "Off"  # Recommendations only, no automatic updates
  resourcePolicy:
    containerPolicies:
    - containerName: "pawd"
      minAllowed:
        cpu: 500m
        memory: 1Gi
      maxAllowed:
        cpu: 8000m
        memory: 16Gi
      controlledResources: ["cpu", "memory"]
    - containerName: "metrics-exporter"
      minAllowed:
        cpu: 100m
        memory: 128Mi
      maxAllowed:
        cpu: 200m
        memory: 256Mi
      controlledResources: ["cpu", "memory"]
---
# VPA for Full Nodes
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: paw-node-vpa
  namespace: paw
  labels:
    app.kubernetes.io/name: paw
    app.kubernetes.io/component: node
spec:
  targetRef:
    apiVersion: "apps/v1"
    kind: Deployment
    name: paw-node
  updatePolicy:
    updateMode: "Off"
  resourcePolicy:
    containerPolicies:
    - containerName: "pawd"
      minAllowed:
        cpu: 250m
        memory: 512Mi
      maxAllowed:
        cpu: 4000m
        memory: 8Gi
      controlledResources: ["cpu", "memory"]
---
# VPA for API (can use Auto mode for stateless API)
apiVersion: autoscaling.k8s.io/v1
kind: VerticalPodAutoscaler
metadata:
  name: paw-api-vpa
  namespace: paw
  labels:
    app.kubernetes.io/name: paw
    app.kubernetes.io/component: api
spec:
  targetRef:
    apiVersion: "apps/v1"
    kind: Deployment
    name: paw-api
  updatePolicy:
    updateMode: "Auto"  # Safe for stateless API pods
  resourcePolicy:
    containerPolicies:
    - containerName: "*"
      minAllowed:
        cpu: 100m
        memory: 128Mi
      maxAllowed:
        cpu: 2000m
        memory: 4Gi
      controlledResources: ["cpu", "memory"]
